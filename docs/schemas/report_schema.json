{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "https://steer-framework.dev/schemas/report/0.1.0/report_schema.json",
    "title": "Test report",
    "description": "A test report generated by a STEER test",
    "type": "object",
    "properties": {
        "report": {
            "type": "object",
            "properties": {
                "test name": { "type": "string" },
                "test suite": { "type": "string" },
                "schedule id": { "type": "string" },
                "test description": { "type": "string" },
                "test conductor": { "type": "string" },
                "test notes": { "type": "string" },
                "report level": {"$ref": "#/$defs/reportLevelType" },
                "program name": { "type": "string" },
                "program version": { "$ref": "#/$defs/semanticVersionType" },
                "operating system": { "type": "string" },
                "architecture": { "type": "string" },
                "entropy source": { "type": "string" },
                "start time": { "type": "string", "format": "date-time" },
                "parameters": { 
                    "type": "array",
                    "items": {
                        "type": "object",
                        "oneOf": [
                            { "$ref": "#/$defs/valueType" },
                            { "$ref": "#/$defs/valueSetType" }
                        ]
                    },
                    "uniqueItems": true
                },
                "configurations": {
                    "type": "array",
                    "items": { "$ref": "#/$defs/configurationType" },
                    "uniqueItems": true
                },
                "completion time": { "type": "string", "format": "date-time"},
                "test duration": { "type": "string" },
                "criteria": { 
                    "type": "array",
                    "items": { "$ref": "#/$defs/criterionType" },
                    "uniqueItems": true
                },
                "evaluation": { "$ref": "#/$defs/evaluationType" }
            },
            "additionalProperties": false,
            "required": [
                "test name",
                "program name",
                "program version",
                "operating system",
                "architecture",
                "entropy source",
                "start time",
                "completion time",
                "test duration",
                "parameters",
                "criteria",
                "evaluation"
            ]      
        }
    },
    "additionalProperties": false,
    "required": [ "report" ],
    "$defs": {
        "nonNegativeIntegerType": {
            "type": "string",
            "pattern": "^\\+?(0|[1-9]\\d*)$"
        },
        "semanticVersionType": {
            "type": "string",
            "pattern": "^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$"
        },
        "dataType": {
            "type": "string",
            "enum": [
                "boolean",
                "double precision floating point",
                "extended precision floating point",
                "signed 8-bit integer",
                "signed 16-bit integer",
                "signed 32-bit integer",
                "signed 64-bit integer",
                "single precision floating point",
                "unsigned 8-bit integer",
                "unsigned 16-bit integer",
                "unsigned 32-bit integer",
                "unsigned 64-bit integer",
                "utf-8 string"
            ]
        },
        "reportLevelType": { 
            "type": "string", 
            "enum": [ "summary", "standard", "full" ] 
        },
        "valueType": {
            "type": "object",
            "properties": {
                "name": { "type": "string" },
                "data type": { "$ref": "#/$defs/dataType" },
                "precision": { "$ref": "#/$defs/nonNegativeIntegerType" },
                "units": { "type": "string" },
                "value": { "type": "string" }
            },
            "additionalProperties": false,
            "required": [ "name", "data type", "value" ]
        },
        "valueSetType": {
            "type": "object",
            "properties": {
                "name": { "type": "string" },
                "data type": { "$ref": "#/$defs/dataType" },
                "precision": { "$ref": "#/$defs/nonNegativeIntegerType" },
                "units": { "type": "string" },
                "values": {
                    "type": "array",
                    "items": {
                        "type": "object",
                        "properties": {
                            "label": { "type": "string" },
                            "value": { "type": "string" }
                        },
                        "additionalProperties": false,
                        "required": [ "label", "value" ]
                    },
                    "uniqueItems": true
                }
            },
            "additionalProperties": false,
            "required": [ "name", "data type", "values" ]
        },
        "calculationType": {
            "type": "object",
            "oneOf": [
                { "$ref": "#/$defs/valueType" },
                { "$ref": "#/$defs/valueSetType" }
            ]
        },
        "criterionType": {
            "type": "object",
            "properties": {
                "criterion": { "type": "string" },
                "result": { "type": "boolean" }
            },
            "additionalProperties": false,
            "required": [ "criterion", "result" ]
        },
        "evaluationType": {
            "type": "string",
            "enum": [ "fail", "inconclusive", "pass" ]
        },
        "testType": {
          	"type": "object",
            "properties": {
                "test id": { "$ref": "#/$defs/nonNegativeIntegerType" },
                "calculations": {
                    "type": "array",
                    "items": { "$ref": "#/$defs/calculationType" },
                    "uniqueItems": true
                },
                "criteria": { 
                    "type": "array",
                    "items": { "$ref": "#/$defs/criterionType" },
                    "uniqueItems": true
                },
                "evaluation": { "$ref": "#/$defs/evaluationType" }
            },
            "additionalProperties": false,
            "required": [ "test id", "criteria", "evaluation" ]
        },
        "metricType": {
            "type": "object",
            "oneOf": [
                { "$ref": "#/$defs/valueType" },
                { "$ref": "#/$defs/valueSetType" }
            ]
        },
        "configurationType": {
          	"type": "object",
            "properties": {
                "configuration id": { "$ref": "#/$defs/nonNegativeIntegerType" },
                "attributes": {
                    "type": "array",
                    "items": { "$ref": "#/$defs/valueType" },
                    "uniqueItems": true
                },
                "tests": {
                    "type": "array",
                    "items": { "$ref": "#/$defs/testType" },
                    "uniqueItems": true
                },
                "metrics": { 
                  "type": "array",
                  "items": { "$ref": "#/$defs/metricType" },
                  "uniqueItems": true
                },
                "criteria": { 
                    "type": "array",
                    "items": { "$ref": "#/$defs/criterionType" },
                    "uniqueItems": true
                },
                "evaluation": { "$ref": "#/$defs/evaluationType" }
            },
            "additionalProperties": false,
            "required": [  "configuration id", "tests", "criteria", "evaluation" ]
        }
    }
}
